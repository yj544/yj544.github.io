---
title: "Java I/O"
categories:
  - java
tags:
  - java
  
toc: true
toc_icon: "cog"
toc_sticky: true
---

### Stream
- Stream : 입출력을 지원하는 클래스로 단방향 전송만 지원하여 입력은 InputStream, 출력은 OutputStream으로 구분된다.
  - InputStream은 모든 InputStream 클래스의 부모 클래스이고, OutputStream은 모든 OutputStream의 부모 클래스이다. 
  - InputStream 하위 클래스 : AudioInputStream, ByteArrayInputStream, FileInputStream, FilterInputStream, InputStream, ObjectInputStream, PipedInputStream, SequenceInputStream, StringBufferInputStream
  - OutputStream 하위 클래스 : ByteArrayOutputStream, FileOutputStream, FilterOutputStream, ObjectOutputStream, OutputStream, PipedOutputStream
- BufferedStream : 입/출력 대상 데이터를 일정 크기의 배열만큼 버퍼링하여 처리하는 방식으로 일반 Stream 보다 빠르다.
  ```java
  public class BufferedInputStream extends FilterInputStream {

    //기본 버퍼 사이즈 및 최대 버퍼 사이즈가 정해져있고
    private static int DEFAULT_BUFFER_SIZE = 8192;
    private static int MAX_BUFFER_SIZE = Integer.MAX_VALUE - 8;
    
    //생성자 : 버퍼 사이즈에 대한 정보가 없으면 기본 버퍼 사이즈를 사용
    public BufferedInputStream(InputStream in) {
      this(in, DEFAULT_BUFFER_SIZE);
    }
  
    //생성자 : 버퍼 사이즈에 대한 정보가 있으면 해당 값을 사이즈로 사용
    public BufferedInputStream(InputStream in, int size) {
      super(in);
      if (size <= 0) {
          throw new IllegalArgumentException("Buffer size <= 0");
      }
      buf = new byte[size];
    }
  }
  ```
  - 내부적으로 사용하는 변수
  ```java
  // 버퍼에서 현재 포지션, 다음 읽히는 문자의 인덱스
  protected int pos;
  // 현재 포지션을 기억해두는 용도 (mark 함수 호출될 때 수행됨)
  protected int markpos = -1;
  // markpos가 reset에 의해 무효화됐을 때 makrpos부터 읽을 최대 바이트?
  protected int marklimit;
  ```
  
  
  - 버퍼링된 데이터를 건너뛰면 알아서 다시 버퍼 크기만큼 새로운 데이터를 채우는 방식으로 mark와 reset 함수가 추가로 제공된다.
    - mark : markpos가 reset에 의해 무효화됐을 때 읽을 최대 바이트를 기록하는 함수
      ```java
      public synchronized void mark(int readlimit) {
          marklimit = readlimit;
          markpos = pos;
      }
      ```
    - reset : pos 
      ```java
      public synchronized void reset() throws IOException {
        getBufIfOpen(); // Cause exception if closed
        if (markpos < 0)
            throw new IOException("Resetting to invalid mark");
        pos = markpos;
      }
      ```

